// ============================================================
// КАК РАБОТАЕТ СИСТЕМА ТЕМИЗАЦИИ (LIGHT/DARK MODE)
// ============================================================

/*
Наша система темизации использует комбинацию:
1. CSS переменные (@theme и @dark в Tailwind)
2. Класс 'dark' на html элементе
3. localStorage для сохранения предпочтения пользователя
4. React state для отслеживания текущей темы

═══════════════════════════════════════════════════════════
ЭТАП 1: ОПРЕДЕЛЕНИЕ ПЕРЕМЕННЫХ В CSS
═══════════════════════════════════════════════════════════

В index.css у нас есть две группы переменных:

// СВЕТЛАЯ ТЕМА (по умолчанию)
@theme {
  --color-bg-light: #f9fafb;    ← светлый фон
  --color-gray-700: #374151;    ← тёмный текст
  --color-gray-200: #e5e7eb;    ← светлые бордеры
  ...
}

// ТЁМНАЯ ТЕМА (когда на html есть класс 'dark')
@dark {
  --color-bg-light: #1f2937;    ← тёмный фон
  --color-gray-700: #d1d5db;    ← светлый текст
  --color-gray-200: #374151;    ← тёмные бордеры
  ...
}

Когда на html элемент добавляется класс 'dark',
Tailwind/CSS автоматически выбирает переменные из @dark блока.

═══════════════════════════════════════════════════════════
ЭТАП 2: КОМПОНЕНТ THEMTOGGLE
═══════════════════════════════════════════════════════════

const ThemeToggle = () => {
  // 1. Читаем текущее состояние из DOM
  useEffect(() => {
    const isDarkMode = document.documentElement.classList.contains('dark');
    setIsDark(isDarkMode);
  }, []);

  // 2. При клике на переключатель
  const handleToggle = () => {
    if (!isDark) {
      // ДОБАВЛЯЕМ КЛАСС 'dark'
      document.documentElement.classList.add('dark');
      localStorage.setItem('theme', 'dark');
    } else {
      // УДАЛЯЕМ КЛАСС 'dark'
      document.documentElement.classList.remove('dark');
      localStorage.setItem('theme', 'light');
    }
  };
};

═══════════════════════════════════════════════════════════
ЭТАП 3: ЧТО ПРОИСХОДИТ ПРИ ДОБАВЛЕНИИ КЛАССА 'dark'
═══════════════════════════════════════════════════════════

БЫЛО:
<html>                          // Класса 'dark' НЕТ
  <body style="background: var(--color-bg-light)">
    Фон = #f9fafb (светлый)

СТАЛО:
<html class="dark">             // Класс 'dark' ДОБАВЛЕН
  <body style="background: var(--color-bg-light)">
    Фон = #1f2937 (тёмный)     // Tailwind выбрал переменную из @dark

═══════════════════════════════════════════════════════════
ЭТАП 4: КАК TAILWIND ВЫБИРАЕТ ПРАВИЛЬНЫЕ ПЕРЕМЕННЫЕ
═══════════════════════════════════════════════════════════

Когда мы пишем в компоненте:
<div className="bg-white text-gray-700">

Tailwind преобразует это в:
// БЕЗ класса 'dark' на html:
div {
  background-color: var(--color-white);  // из @theme = #ffffff
  color: var(--color-gray-700);          // из @theme = #374151 (тёмный)
}

// С КЛАССОМ 'dark' на html:
html.dark div {
  background-color: var(--color-white);  // из @dark = #ffffff
  color: var(--color-gray-700);          // из @dark = #d1d5db (светлый)
}

═══════════════════════════════════════════════════════════
ЭТАП 5: ЖИЗНЕННЫЙ ЦИКЛ ПЕРЕКЛЮЧЕНИЯ ТЕМЫ
═══════════════════════════════════════════════════════════

1. СТРАНИЦА ЗАГРУЖАЕТСЯ
   ├─ Читаем localStorage.getItem('theme')
   ├─ Если 'dark' → добавляем класс на html
   └─ Если нет → класс не добавляем (светлая тема по умолчанию)

2. ПОЛЬЗОВАТЕЛЬ КЛИКАЕТ НА ПЕРЕКЛЮЧАТЕЛЬ
   ├─ setIsDark(!isDark)
   ├─ document.documentElement.classList.add/remove('dark')
   └─ localStorage.setItem('theme', 'dark'/'light')

3. БРАУЗЕР ПРИМЕНЯЕТ НОВЫЕ CSS ПЕРЕМЕННЫЕ
   ├─ Все элементы тут же видят новые значения переменных
   ├─ Благодаря transition: 0.3s - переход плавный
   └─ Все цвета меняются одновременно

4. ПРИ СЛЕДУЮЩЕЙ ЗАГРУЗКЕ
   ├─ Читаем localStorage → знаем какая была тема
   ├─ Добавляем/не добавляем класс 'dark'
   └─ Тема восстанавливается

═══════════════════════════════════════════════════════════
ПРИМЕР: ИЗМЕНЕНИЕ ФОНА И ТЕКСТА
═══════════════════════════════════════════════════════════

В index.css указали переходы:
body {
  background-color: var(--color-bg-light);
  color: var(--color-gray-700);
  transition: background-color 0.3s ease, color 0.3s ease;
}

ВРЕМЕННАЯ ШКАЛА при переключении:

T = 0ms
  html {background-color: #f9fafb, color: #374151}
  User clicks toggle
  ↓

T = 1ms
  html.dark added
  Tailwind переопределяет переменные
  ↓

T = 1-300ms
  CSS transition медленно меняет значения:
  #f9fafb → #1f2937 (фон светлеет)
  #374151 → #d1d5db (текст светлеет)
  ↓

T = 300ms
  Переход завершён
  Новая тема полностью применена

═══════════════════════════════════════════════════════════
ПОЧЕМУ ИСПОЛЬЗУЕМ localStorage
═══════════════════════════════════════════════════════════

localStorage - это браузерное хранилище, которое:
✅ Сохраняет данные на устройстве пользователя
✅ Сохраняется между перезагрузками страницы
✅ Не требует сервера
✅ Работает оффлайн

localStorage.setItem('theme', 'dark')  // Сохраняем выбор
localStorage.getItem('theme')          // Читаем при загрузке

═══════════════════════════════════════════════════════════
СХЕМА ВСЕЙ СИСТЕМЫ
═══════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────┐
│                   index.css                         │
│  @theme { --color-bg-light: #f9fafb }              │
│  @dark  { --color-bg-light: #1f2937 }              │
└────────────────────┬────────────────────────────────┘
                     │
                     ↓
┌─────────────────────────────────────────────────────┐
│              <html class="dark">                    │
│  Наличие класса определяет какие переменные        │
│  будут использоваться CSS                           │
└────────────────────┬────────────────────────────────┘
                     │
                     ↓
┌─────────────────────────────────────────────────────┐
│            ThemeToggle Component                    │
│  onClick → classList.add/remove('dark')            │
│          → localStorage.setItem('theme', ...)      │
└────────────────────┬────────────────────────────────┘
                     │
                     ↓
┌─────────────────────────────────────────────────────┐
│            Browser Rendering                       │
│  Новые CSS переменные применяются ко всем         │
│  элементам которые их используют                   │
└─────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════
БУДУЩЕЕ: ZUSTAND ИНТЕГРАЦИЯ
═══════════════════════════════════════════════════════════

Когда добавим Zustand, сейчас локальное состояние
в ThemeToggle станет глобальным:

// themeStore.ts
const useThemeStore = create((set) => ({
  isDark: false,
  toggleTheme: () => set(state => ({ isDark: !state.isDark }))
}));

// ThemeToggle.tsx
const { isDark, toggleTheme } = useThemeStore();
onClick={() => toggleTheme()}  // Вместо setIsDark(!isDark)

Это даст возможность управлять темой из любого места в приложении!

*/
